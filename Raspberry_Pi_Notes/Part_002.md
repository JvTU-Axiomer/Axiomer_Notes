# 第二讲：利用笔记本远程显示树莓派虚拟桌面

---

**目录：**

[TOC]

---

## 一、准备阶段

**准备材料：**

* 硬件：
  * 树莓派4B开发板；
  * 读卡器；
  * 适用于树莓派的SD内存卡；
  * 笔记本一台.
* 软件：
  * `Raspberry Pi Imager`.

**操作步骤：**

1. 首先打开树莓派官方网站：https://www.raspberrypi.org/.
   ![树莓派官方网站](./assets/20230603175302.png)
2. 点击网页上方`Computers`下拉栏中的`Visit raspberrypi.com`选项.
   ![Visit raspberrypi.com选项](./assets/20230603175442.png)
3. 点击`Software`选项，进入树莓派系统介绍与安装界面.
   ![Software选项](./assets/20230603175613.png)
4. 下拉页面，找到树莓派官方烧录工具`Raspberry Pi Imager`的下载选项，开始下载.
   ![下载Raspberry Pi Imager](./assets/20230603175741.png)
5. 安装好`Raspberry Pi Imager`之后，进入烧录界面；这是需要将树莓派的SD卡通过读卡器与笔记本电脑相连.
   ![Raspberry Pi Imager开始界面](./assets/20230603175955.png)
6. 在烧录软件开始界面选择需要写入的操作系统（推荐选择官方`recommend`的操作系统），以及选择储存卡（即树莓派的SD卡，已经通过读卡器与笔记本连接）.
   ![选择操作系统和储存卡](./assets/20230603180212.png)
7. ==这是最关键的一步！== 在选择了操作系统和储存卡之后，界面右下角会出现齿轮图标，单击进入设置页面，在“==开启SSH服务==”、“==Set username and password==”以及“==配置WIFI==”三个选项卡前打勾，否则在使用`PuTTY`将笔记本和树莓派进行远程连接时会出现无法连接的错误.
   ![设置_01](./assets/20230603180837.png)
   ![设置_02](./assets/20230603180908.png)
   ![设置_03](./assets/20230603180920.png)
   ![设置_04](./assets/20230603180934.png)
8. 配置好设置之后选择保存，并开始烧录.烧录的时间一般会在`5~10min`之内，请耐心等待.
9. 烧录成功之后，SD储存卡一般会自动从笔记本上安全弹出.此时将储存卡取下，插入树莓派的内存卡卡槽内.

**可能坑点：**

* 忘记配置烧录前的树莓派设置，从而导致之后无法将笔记本与树莓派通过`PuTTY`进行远程连接.
* 在配置`WIFI`热点名和密码时写错名称或密码，导致之后无法远程连接.
* 烧写成功之后会弹出报错警告，这是正常现象.之后已经烧录好的SD卡每次在被笔记本读取时都会弹出报错警告，这是正常现象，关掉警告即可，不必慌张.
  ![烧录完成之后弹出报错警告](./assets/20230603181909.png)

---

## 二、使用手机无线热点连接笔记本和树莓派（RDP远程连接控制树莓派）

> 连接到笔记本热点的设备，能够在笔记本上直接看到该设备的`ip`地址.

> 使用手机无线热点连接笔记本和树莓派的关键在于**将树莓派连接到指定的网络中**.

**准备材料：**

* 硬件：
  * 树莓派4B开发板（已插入卡内烧写有操作系统的SD卡）；
  * 适用树莓派的配电器；
  * 可以打开WLAN热点的手机一部；
  * 笔记本一台.
* 软件：
  * `PuTTY`；
  * `Advanced IP Scanner`.

**操作步骤：**

1. 将树莓派通过配电器为其供电（树莓派会有角灯亮起和闪烁）.
2. 等待大约`3~5min`，树莓派会自动连接到手机提供的热点.
3. 将笔记本连接到之前烧录时为树莓派配置的同一个无线网下（即上一步中的热点）.
4. `Win + R`打开笔记本的`cmd窗口`，输入命令`ipconfig`.
   ![输入命令`ipconfig`](./assets/20230603183903.png)
5. 在输出的信息中找到`无线局域网适配器 WLAN`部分，在该部分找到`IPv4 地址`一栏，记下对应的地址.
   ![无线局域网适配器 WLAN 栏](./assets/20230603183946.png)
6. 打开`Advanced IP Scanner`，将欲扫描的区间范围改成将上一步记下的地址的最后一个小数点后的数字分别换成`1`和`255`的范围.
   ![输入地址范围](./assets/20230603184128.png)
7. 打开手机端的`个人热点` - `已连接设备`，在已连接设备中找到`raspberrypi`，记下下方的字符串.
   ![手机端`已连接设备`界面](./assets/20230603184429.png)
8. 将上一步记下的字符串与`Advanced IP Scanner`扫描结束之后列出的`MAC地址`进行匹配，匹配上的一栏中的`IP`即为树莓派的`IP地址`.
   ![找到树莓派的`IP地址`](./assets/20230603184637.png)
9. 打开`PuTTY`，在`Host Name`一栏输入上一步得到的树莓派的IP地址，点击`Open`选项，在弹出的警告窗口中点击`Accept`选项.
    ![输入树莓派的`IP地址`](./assets/20230603185000.png)
    ![点击警告窗口中的Accept选项](./assets/20230603184851.png)
10. 在弹出的命令行窗口中输入树莓派的`Username`和`Password`（注意`Password`不可见，需要盲打），回车确认，弹出树莓派的设备信息，则连接成功.
    ![输入`Username`和`Password`](./assets/20230603185332.png)

**可能坑点：**

* 树莓派烧录后首次上电连接无线热点耗时较长，需要耐心等待；当手机热点信息中已连接设备界面出现了`raspberrypi`设备时，树莓派就成功连接了.
* 在使用`ipconfig`命令查询`IPv4地址`时，可能会出现该地址以`172`开头的情况，此时得到的`IPv4地址`不是正确的地址.
  * 解决方法：将`网络和共享中心` - `查看活动网络` - `连接` - `属性` - `共享`下的两个选项卡前的对勾去掉，点击确定退出，再次进入该界面将选项卡前重新打勾刷新，确认后再次退出.

---

## 三、使用网线连接笔记本和树莓派

> 使用网线连接笔记本和树莓派的四个步骤：
> 1. 连线.
> 2. 共享.
> 3. 查找.
> 4. 连接.

> **网络**是树莓派和电脑（控制端）进行数据传递和交换的**介质**.

**准备材料：**

* 硬件：
  * 树莓派4B开发板（已插入卡内烧写有操作系统的SD卡）；
  * 适用树莓派的配电器；
  * 网线一根；
  * 笔记本一台.
* 软件：
  * `PuTTY`.

**操作步骤：**

1. 将已经与手机热点成功连接之后的树莓派通过配电器为其上电.
2. 用网线两端，一端连接树莓派，一端连接笔记本.
3. 打开`控制面板` - `网络和 Internet` - `网络和共享中心`.
   ![`网络和共享中心`界面](./assets/20230603190554.png)
4. 点击进入`查看活动网络`一栏的`连接`，选择`属性` — `共享`，把第一个可选框打勾并选择`以太网`.
   ![`共享`界面](./assets/20230603190736.png)
5. `Win + R`打开笔记本的`cmd窗口`，输入命令`arp -a`.
   ![输入命令`arp -a`](./assets/20230603190923.png)
6. 通过插网线与不插网线执行`arp -a`命令输出信息相对比，找到并记下树莓派的`IP地址`.
   ![找到并记下树莓派的`IP地址`](./assets/20230603191121.png)
7. 打开`PuTTY`，输入`IP地址`后，点击`Open`选项，会弹出警告窗口，点击`Accept`选项关闭窗口.
   ![输入树莓派的`IP地址`](./assets/20230603192127.png)
8. 输入树莓派的`Username`和`Password`，回车确认，弹出树莓派的设备信息，则连接成功.
   ![笔记本与树莓派连接成功](./assets/20230603192215.png)

**可能坑点：**

* 通过在`cmd命令行`窗口中键入`arp -a`命令，可能会出现以下情况：
  * 情况一：获得的树莓派的`IP地址`无效.
    * 解决方法：将`网络和共享中心` - `查看活动网络` - `连接` - `属性` - `共享`下的两个选项卡前的对勾去掉，点击确定退出，再次进入该界面将选项卡前重新打勾刷新，确认后再次退出.
  * 情况二：输入树莓派的`IP地址`显示连接超时或连接错误.
    * 解决方法：多次尝试接口下的`Internet 地址`，可能有效的`IP地址`不是第一个`Internet 地址`，需多次尝试.

## 三、使用RealVNC远程桌面连接树莓派

> `VNC`:
> * **概述：**
>  * 图形桌面共享系统.
> * **组成：**
>  * `VNC`查看器（部署在笔记本）.
>  * `VNC`服务器（部署在树莓派）.
>     * 打开方式：
>        * 使用树莓派系统桌面打开.
>        * 在命令行中使用命令`sudo raspi-config`打开.

**准备材料：**

* 硬件：
  * 树莓派4B开发板（已插入卡内烧写有操作系统的SD卡）；
  * 适用树莓派的配电器；
  * 网线一根；
  * 可以打开WLAN热点的手机一部；
  * 笔记本一台.
* 软件：
  * `RealVNC`.

**操作步骤：**

1. 使用手机无线热点连接方式或者网线连接方式成功连接笔记本和树莓派.
2. 使用`putty`开启`VNC服务`和设置合适分辨率，为后续`VNC`的使用做好提前准备.
   1. 首先输入命令：`sudo raspi-config`，按下回车后，进入配置界面.
    ![输入命令：`sudo raspi-config`](./assets/20230603194914.png)
   2. 通过上下键选择`Interfacing Options`，接着左右键选择`Select`，并按回车键.
    ![选择`Select`](./assets/20230603194947.png)
   3. 接着上下键选择`VNC`，左右键选择`Select`，并按回车键.
    ![选择`VNC`](./assets/20230603195019.png)
   4. 左右键选择`Yes`，并按回车键.
    ![选择`Yes`，并按回车键](./assets/20230603195044.png)
   5. 回车键确定`OK`.
   6. 进入`Display Options`选项，设置分辨率（`1920×1080`），此处不再赘述.
2. 打开`RealVNC`，在页面上方输入树莓派的IP地址，进行远程桌面的连接.
   ![对树莓派进行远程桌面的连接](./assets/20230603195607.png)
3. 输入`Username`和`Password`，点击`OK`，出现树莓派的远程桌面，则远程桌面与树莓派连接成功.
   ![输入`Username`和`Password`，点击`OK`](./assets/20230603195815.png)

**可能坑点：**

* `VNC Viewer`连接树莓派分辨率不适应笔记本屏幕.
  * 解决方法：了解发现，`raspi-config`修改的是树莓派的分辨率，修改成功后树莓派本身的分辨率（包括连接显示器时的分辨率）会发生改变，但不会影响`VNC`端的分辨率；而`vncserver`这条命令修改的是`VNC`端的分辨率，但只能一次生效，开启一个`:1`的端口以供连接。因此，可以用两行`shell`解决问题：
    ``` Python
    #!/bin/sh
    vncserver -geometry 1920x1080 # 修改分辨率，并开启:1端口
    lxappearance # 解决连接后指针变成X的问题
    ```
    可以将脚本放在`pi主目录`下，每次`VNC`连接后执行一次，然后再切换窗口，由于每次开启的都是`:1`端口，所以不用每次新建，只要保留这两个就行：
    ![修改`VNC`端的分辨率](./assets/20230603203605.png)

> 注意：
> `Windows10`系统中自带**远程桌面连接**软件，因此也可以先利用`putty`通过`SSH协议`连接到树莓派中，在`putty`的命令行控制台通过命令`sudo apt-get install xrdp`在树莓派上安装软件`xrdp`之后，再通过系统自带远程桌面连接软件对树莓派和笔记本进行远程连接.

---

## 四、实用小技巧

### 4.1 查看树莓派信息

==输入命令：==
* 安装软件：
  * `sudo apt install screenfetch`.
* 查看设备信息：
  * `screenfetch`.

==显示结果：==

![查看树莓派信息](./assets/20230603203956.png)

### 4.2 查看python版本和位置

==输入命令：==
* `whereis python`.

==显示结果：==

![查看python版本和位置](./assets/20230603204201.png)

可以看到我的树莓派上既安装了版本为`3.9`的Python，也安装了版本为`2.7`的Python.

### 4.3 配置树莓派静态`ip`

==操作步骤：==

1. 查找默认网关.
2. 确定分配给树莓派的`ip`地址.
   * 静态`ip`地址与路由器网段应保持一致.
   * 分配给树莓派的静态`ip`地址与路由器的自动ip地址不能冲突.
3. 修改树莓派的`DHCP`配置文件，写入`ip`地址到配置信息中.
4. 重启树莓派，即可完成对树莓派的静态`ip`配置.

### 4.4 树莓派文件传输及配置树莓派的编译环境

**树莓派文件传输方式：**
* `U盘`传输.
  * 优点：较为快捷、简单.
  * 缺点：需要`U盘`且树莓派和电脑都在附近.
* `VNC`传输.
  * 树莓派需要开启`VNCserver`.
  * 个人电脑需要配置`VNCviewer`.
* 使用`FTP`文件传输协议传输.
  * 需要额外安装`FTP`工具.

**配置树莓派的编译环境：**
* 树莓派环境下Python的使用：
  * 使用命令行方式：
    * 在命令行中输入命令`python`（或`python3`），进入Python编辑器界面.输入Python程序命令后按下回车键执行程序；若想退出Python编辑器，键入`exit()`即可退回到终端.
    * 在树莓派自带Python中安装第三方库时，使用命令`pip install 库名字`（或`pip3 install 库名字`）.
  * 使用==树莓派自带==的Python编辑器`Thonny`编写Python程序.
* 树莓派环境下C语言的使用：
  * 使用树莓派自带的C编辑器`Geany Programmer's Editor`编写C语言程序.

**在树莓派环境下安装第三方库`WiringPi`：**
* 使用命令`sudo apt-get install wiringpi`即可完成第三方库的安装.

### 4.5 树莓派Linux终端操作命令及`nano`和`vi`编辑器的使用

**树莓派Linux终端操作命令：**

* ==提示符：== `pi@raspberrypi:~$ `.
  * `pi`：当前用户名.
  * `raspberrypi`：计算机名称.
  * `~`：表示当前的主目录.
  * `$`：表示需要输入命令的开始位置.
* ==用户权限：==
  * 权限分类：
    * 普通用户权限（`pi`）.
    * 超级用户权限（`sudo`）：拥有全部的权限，象征着无法拒绝.
  * 切换用户权限命令：
    * `sudo su`（标志符号为 `#`）：由普通用户权限切换为超级用户权限.
    * `su pi`（标志符号为 `$`）：由超级用户权限切换为普通用户权限.
* ==常用的Linux终端操作命令：==
  * 切换和显示目录类命令：
    * `pwd`：显示当前所在目录.
    * `cd ..`：切换到上一级目录.
    * `cd ~`：切换到主目录.
    * `cd /`：切换到根目录.
    * `cd dir`：切换到指定目录dir路径下.
    * `ls`：展示当前目录下的文件和文件夹（不含隐藏文件和文件夹）.
    * `ls -a`：展示当前目录下的文件和文件夹（包含隐藏文件和文件夹）.
  * 创建类命令：
    * `touch file`：创建文件`file`.
    * `mkdir dir`：创建目录`dir`.
  * 查看类命令：
    * `cat file`：查看文件`file`的内容.
    * `more file`：查看文件`file`的内容.
  * 删除类命令：
    * `rm file`：删除文件`file`.
    * `rm -r dir`：删除目录`dir`.
  * 重命名和移动类命令：
    * `mv file1 file2`：将文件`file1`重命名为`file2`；若`file1`不存在，则创建文件`file1`并重命名为`file2`.
    * `mv file file_folder`：将文件`file`移动至文件夹`file_folder`中.

**`nano`和`vi`编辑器的使用：**

* ==nano编辑器：==
  * 环境：`Linux系统`和`类Linux系统`.
  * 常用编辑器命令：
    * `nano file`：使用nano编辑器打开文件`file`；若文件`file`不存在，则会先创建文件`file`，再使用nano编辑器打开文件`file`.
    * `Ctrl + O`：保存文件.
    * `Ctrl + X`：退出文件.
* ==vi编辑器：==
  * 环境：`Unix系统`和`Linux系统`.
  * 模式分类：
    * 插入模式（`I`）.
    * 底行模式.
    * 命令模式（`Esc`）.
  * 常用编辑器命令：
    * `vi file`：使用vi编辑器打开文件`file`；若文件`file`不存在，则会先创建文件`file`，再使用vi编辑器打开文件`file`.
    * `w`：保存文件.
    * `q`：退出文件.
    * `wq`：保存并退出文件.
    * `q!`：强制退出文件（不保存直接强制退出文件）.

> 注意：
> * 在vi编辑器下，当打开文件且**处于插入模式**时，若想输入编辑器命令，则需先按下`Esc键`**进入命令模式**之后，再按下冒号键（`:`），在冒号（`:`）之后即可键入想要执行的编辑器命令.