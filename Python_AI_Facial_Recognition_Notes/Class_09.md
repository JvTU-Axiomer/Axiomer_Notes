# 第九讲：Python读取图像

> 计算机视觉：
> * 计算机视觉是人工智能 (`AI`) 的一个领域，是指**让计算机和系统能够从图像、视频和其他视觉输入中获取有意义的信息，并根据该信息采取行动或提供建议**。如果说人工智能赋予计算机思考的能力，那么计算机视觉就是赋予**发现、观察和理解**的能力。
>   * 人脸识别.
>   * 车辆检测.
>   * 字迹识别.
>   * 照片修复.
> * Python中涉及计算机视觉**最常用的库**：
>   * `OpenCV`（简称`cv2`）.

---

**目录：**

[TOC]

---

## 一、读取图片并加载和显示

### 1.1 创建和显示窗口

**使用到的库方法：**

* `namedWindow()`：
  * 功能：
    * 创建命名窗口.
  * 参数声明：
    * 第一个参数：窗口名称.
    * 第二个参数：窗口大小是否可以自定义.
      * `WINDOW_NORMAL`：可以让窗口大小变得可以调节.
* `cv2.resizeWindow()`：
  * 功能：
    * 改变窗口大小.
  * 参数声明：
    * 第一个参数：待修改的窗口名称.
    * 第二个参数：修改后的窗口长（单位是像素）.
    * 第三个参数：修改后的窗口宽（单位是像素）.
* `cv2.imshow()`：
  * 功能：
    * 显示图片.
  * 参数声明：
    * 第一个参数：窗口名称.
    * 第二个参数：待显示的图片名称.
      * `0`代表暂时没有图片的意思.
* `cv2.waitKey()`：
  * 功能：
    * 等待按键.
  * 参数声明：
    * `0`表示任何按键.
      * 如果不按下其他按键，窗口会一直停留而不会自动关闭.
    * `其他整数`表示等待按键的时间，单位是毫秒.
      * 如果超过指定时间没有发生按键操作，窗口会自动关闭.
  * 返回值类型：
    * 会返回按键的`ASCII码值`，是一个`整数`.
* `cv2.destroyAllWindows()`：
  * 功能：
    * 关闭窗口.
  * 参数声明：
    * 

### 1.2 加载显示图片

**使用到的库方法：**

* `imread(path of image)`：
  * 功能：
    * 读取图片，默认读取的是彩色图片.
  * 参数声明：
    * 图片的路径.

### 1.3 实操代码

``` Python
  import cv2

  # 读取一张图片.
  img = cv2.imread('cat.jpeg') # 使用相对路径

  """ 一、创建和显示窗口 """

  ''' 1. 创建并命名窗口 '''
  # WINDOW_NORMAL：可以由程序员自定义窗口大小，让窗口大小变得可以调节.
  cv2.namedWindow('JvTU', cv2.WINDOW_NORMAL)  # 常量一般用大写字母来表示.
  ''' 2. 修改窗口大小 '''
  cv2.resizeWindow('JvTU', 800, 600)  # 单位是像素.
  ''' 3. 在窗口中加载和显示图片 '''
  # imshow -> ImageShow.
  cv2.imshow('JvTU', img)  # 0代表没有图片的意思.
  ''' 4. 关闭窗口 '''
  # waitKey方法表示等待按键，0表示任何按键；其他整数表示等待按键的时间，单位是毫秒，超过时间没有发生按键操作窗口会自动关闭.
  key = cv2.waitKey(0)  # 0代表任意键.
  # 会返回按键的ASCII码值，是一个整数.
  # ord 函数会返回一个符号（包含字母和特殊符号）的ASCII码值.
  if key == ord('q'):
      cv2.destroyAllWindows()

  """ 二、加载和显示图片 """

  # 读取一张图片.
```

---

## 二、视频采集

> 视频是由**图片**组成的，视频的**每一帧就是一幅图片**，一般是`30帧`，表示`一秒显示30张图片`.

**使用到的库方法：**

* `cv2.VideoCapture()`：
  * 功能：
    * 捕获并摄像头.
  * 参数声明：
    * 表示待捕获的摄像头编号.
      * 用数字来表示不同的设备，比如`0`或`1`.
      * 电脑上的摄像头编号从下标`0`开始，因此`0`表示第一个摄像头.
    * 如果是视频文件, 可以直接指定路径即可.
      ``` Python
      # 打开视频文件 
      vc = cv2.VideoCapture('./1.mp4')
      ```
  * 返回值类型：
    * 被捕获摄像头类型.
* `cap.read()`：
  * 功能：
    * 从摄像头读取视频.
  * 返回值类型：
    * 返回两个值.
      * 第一个返回值：是否读取到图片.
      * 第二个返回值：当前读到的一帧图片.
* `cap.release()`：
  * 功能：
    * 释放摄像头资源.

**实操代码：**

``` Python
  import cv2
  # 电脑上的摄像头编号从下标0开始，因此0表示第一个摄像头.
  # 打开视频设备.
  cap = cv2.VideoCapture(0)

  cv2.namedWindow('JvTU', cv2.WINDOW_NORMAL)
  cv2.resizeWindow('JvTU', 800, 600)

  # 循环来读取每一帧图片.
  while True:
      # 从摄像头读取视频，返回两个值.第一个：是否读取到图片；第二个：当前读到的一帧图片.
      flag, img = cap.read()
      # 将视频帧放在窗口中显示.
      cv2.imshow('JvTU', img)
      # 建议调到25以内，表示每25毫秒刷新一张图片.
      key = cv2.waitKey(1)
      if key == ord('q'):
          break  # 用户输入q键，然后退出循环.

  cap.release()  # 释放摄像头资源.
  cv2.destroyAllWindows()
```

---

## 三、视频录制

**使用到的库方法：**

* `cv2.VideoWriter_fourcc(*'mp4v')`：
  * 功能：
    * 定义视频文件输出格式.
    * 实质是`解包操作`，即等同于：`'m'，'p'，'4'，'v'`.
  * 参数声明：
    * `*xxxv`.
      * `*`：通配符.
      * `xxx`：指定输出的视频格式（`mp4`，`avi`，...）.
      * `v`：表示`video`，即指定输出的是视频.
  * 返回值类型：
    * 返回多媒体文件格式.
* `cv2.VideoWriter('my_video.mp4', fourcc, 25, (640, 480))`：
  * 功能：
    * 定义一个输出视频的文件.
  * 参数声明：
    * 第一个参数：输出文件名.
    * 第二个参数：多媒体文件格式.
    * 第三个参数：帧率.
      * 一般在`25~50`之间.
    * 第四个参数：分辨率.
      * 用一个元组`(r, c)`表示分辨率的大小.
      * `(640, 480)`表示摄像头拍视频, 这个大小搞错了也不行.
        * 主要是这个分辨率.
  * 返回值类型：
    * 用返回值将捕获摄像头拍摄到的视频的每一帧输出到指定的视频文件中.
* `vw.write()`：
  * 功能：
    * 把一帧一帧的图片，写入到视频文件中去，即编码并写入缓存.
  * 参数类型：
    * 接收图片的变量.
* `vw.release()`：
  * 功能：
    * 缓存内容写入磁盘, 并释放资源，即释放视频文件.
      * 实际上是关闭`IO操作流`，最后才能生成完整的视频文件.

**实操代码：**

```Python
  import cv2

  # 输出一个视频文件：mp4格式、avi格式...
  # 视频文件输出格式定义，就是解包操作，等同于：'m'，'p'，'4'，'v'.
  fourcc = cv2.VideoWriter_fourcc(*'mp4v')  # v 代表视频.

  # 定义一个输出视频的文件
  vw = cv2.VideoWriter('my_video.mp4', fourcc, 25, (640, 480))  # 用vw将捕获摄像头拍摄到的视频的每一帧输出到指定的视频文件中.

  # 电脑上的摄像头编号从下标0开始，因此0表示第一个摄像头.
  # 打开视频设备.
  cap = cv2.VideoCapture(0)

  cv2.namedWindow('JvTU', cv2.WINDOW_NORMAL)
  cv2.resizeWindow('JvTU', 800, 600)

  # 循环来读取每一帧图片.
  while True:
      # 从摄像头读取视频，返回两个值.第一个：是否读取到图片；第二个：当前读到的一帧图片.
      flag, img = cap.read()
      # 将视频帧放在窗口中显示.
      cv2.imshow('JvTU', img)

      # 把一帧一帧的图片，写入到视频文件中去.
      vw.write(img)
      # 建议调到25以内，表示每25毫秒刷新一张图片.
      key = cv2.waitKey(1)
      if key == ord('q'):
          break  # 用户输入q键，然后退出循环.

  cap.release()  # 释放摄像头资源.
  vw.release()  # 释放视频文件，实际上是关闭IO操作流，最后才能生成完整的视频文件.
  cv2.destroyAllWindows()
```

---

## 四、总结

**`opencv-python`中常用到的库函数：**

* `namedWindow()`：
  * 创建并命名窗口.
* `imshow()`：
  * 显示图片.
* `destroyAllwindws()`：
  * 摧毁窗口.
* `resizeWindow()`：
  * 改变窗口大小.
* `waitKey()`：
  * 等待用户输入.
* `cv2.imread()`：
  * 读取图片.
* `cv2.VideoWriter()`：
  * 把图片写入到视频中（录制视频）.
* `cv2.VideoCapture()`：
  * 打开摄像头或者打开视频文件.